<style type="text/css">
  .editar {color: blue; cursor:pointer;}
  #contenedorForm {margin-left: 45px; font-size:12px;}
  .boton {   color: black; padding: 5px; margin: 10px;
    background-color: #b9c9fe;
    font-weight: bold; }
</style>
<section class="panel">
  <header class="panel-heading">
    Detalles del Proyecto
    <span class="pull-right">
    </span>
    <span class="pull-right">
    <a href="/proyecto/index/listar" class=" btn btn-primary btn-sm" > Volver</a> 
   
  </span>
  </header>
   

</section>
<div class="row">
  <div class="col-md-8">
    <section class="panel">
      <div class="bio-graph-heading project-heading" style="background: rgba(0, 105, 173, 1); font-size: 14px;">
        <strong>  Proyecto: <?php print_r($this->proyecto['proyectoid']); echo "<br>";
          print_r($this->proyecto['nombre_proyecto'])?>
        </strong>
      </div>
      <div class="panel-body bio-graph-info">
        <div class="row p-details">
          <div class="bio-row">
            <p><span class="bold">Cliente</span>: <?php
              $buscacliente = new Admin_Model_DbTable_Cliente();
              $buscanombre_cliente=$buscacliente->_getClientexIndice($this->proyecto['clienteid']);
              if ($buscanombre_cliente)
                { print_r($buscanombre_cliente[0]['nombre_comercial']); }
              else
                { echo "< None >"; } ?>
            </p>
          </div>
          <div class="bio-row">
            <p><span class="bold">Unidad Minera</span>: <?php
              $buscaunidad = new Admin_Model_DbTable_Unidadminera();
              $buscanombre_unidad=$buscaunidad->_getUnidadmineraxid($this->proyecto['clienteid'],$this->proyecto['unidad_mineraid']);
              if ($buscanombre_unidad)
                { print_r($buscanombre_unidad[0]['nombre']); }
              else
                { echo "< None >"; }
              ?>
            </p>
          </div>
          <div class="bio-row">
            <p><span class="bold">Codigo</span>: <?php print_r($this->proyecto['proyectoid'])?></p>
          </div>
          <div class="bio-row">
            <p><span class="bold">Estado</span>: <span class="label label-primary"></span><?php
              if ($this->proyecto['estado']=='A') { echo "Activo" ;}

              if ($this->proyecto['estado']=='CA') { echo "Cancelado" ;}
              ?>

            </p>
          </div>
          <div class="bio-row">
            <p><span class="bold">Fecha Inicio </span>: <?php print_r($this->proyecto['fecha_inicio'])?></p>
          </div>
          <div class="bio-row">
            <p><span class="bold">Fecha Cierre</span>: <?php print_r($this->proyecto['fecha_cierre'])?></p>
          </div>
        </div>
      </div>
    </section>


<section>
    <div ng-app="moduloCp">
              <div ng-view>

              </div>
            </div>

            <script type="text/javascript" src="/js/angular-route.js"></script>
            <script type="text/javascript" src="/js/Chart.js"></script>
            <script type="text/javascript" src="/js/angular-chart.js"></script>
            <script type="text/javascript" src="/js/modulo-controlproyecto.js"></script>
     
            <script type="text/javascript" src="/js/checklist-model.js"></script>
            <script type="text/javascript" src="/js/xeditable.js"></script>
            <link rel="stylesheet" type="text/css" href="/css/style-controlproyecto.css">
            <link rel="stylesheet" type="text/css" href="/css/xeditable.css">
        
            <script src="http://m-e-conroy.github.io/angular-dialog-service/javascripts/dialogs.min.js" type="text/javascript"></script>


  
</section>


<!-- este es el menu ge configuracion-->
<section class="panel">
  <header class="panel-heading tab-bg-dark-navy-blue ">
    <ul class="nav nav-tabs">
      <li class="active">
        <a data-toggle="tab" href="#configurar">Configurar
         <i class="fa fa-home"></i>
        </a>
      </li>
   
      <li class="">
        <a data-toggle="tab" href="#control">Control</a>
      </li>

      <li class="">
        <a data-toggle="tab" href="#monitoreo">Monitoreo</a>
      </li>

      <li class="">
        <a data-toggle="tab" href="#planeamiento">Planeamiento</a>
      </li>

      <li class="">
        <a data-toggle="tab" href="#finanzas">Finanzas</a>
      </li>

      <li class="">
        <a data-toggle="tab" href="#indicadores">Indicadores</a>
      </li>
   
   
    </ul>
  </header>


  <div class="panel-body">
    <div class="tab-content">
      <div id="configurar" class="tab-pane active ">
        <a id="hojaresumen" class="btn btn-success btn-xs" href="/proyecto/index/hojaresumen/codigo_prop_proy/<?php echo $this->codigoproyecto ?>/proyectoid/<?php echo $this->proyectoid ?>/propuestaid/<?php echo $this->propuestaid ?>/revision/<?php echo $this->revision ?>">Hoja de Resumen</a>
        <a id="save" class="btn btn-success btn-xs" href="#">Otros</a>
      </div>
 
      <div id="control" class="tab-pane  ">
        <a id="save" class="btn btn-success btn-xs" href="#">Performance</a>
        <a id="save" class="btn btn-success btn-xs" href="#">Curva S</a>
        
        <a id="listaentregables" class="btn btn-success btn-xs" href="/control/control/listaentregables/codigo_prop_proy/<?php echo $this->codigoproyecto ?>/proyectoid/<?php echo $this->proyectoid ?>/revision/<?php echo $this->revision?> ">Lista de Entregables</a>


        <a id="save" class="btn btn-success btn-xs" href="#">Otros</a>        
      </div>

      <div id="monitoreo" class="tab-pane  ">
        <a id="save" class="btn btn-success btn-xs" href="#">Ordenes de Cambio</a>
        <a id="save" class="btn btn-success btn-xs" href="#">Lecciones Aprendidas</a>
    
      </div>

      <div id="planeamiento" class="tab-pane  ">
      
      </div>

      <div id="finanzas" class="tab-pane  ">
        <a id="save" class="btn btn-success btn-xs" href="#">Valorizacion</a>
        <a id="save" class="btn btn-success btn-xs" href="#">Orden de Facturacion</a>
      </div>
   
      <div id="indicadores" class="tab-pane  ">
        <a id="save" class="btn btn-success btn-xs" href="#">Cost Flow HH</a>
        <a id="save" class="btn btn-success btn-xs" href="#">Cost Flow Total</a>
      </div>

    </div>


</section>



<!--  -->

    <section class="panel">
      <?php
      $proyectoid=$this->proyecto['proyectoid'];
      $nombre_fichero = './upload/proyecto/'.$proyectoid.'-HH.xls';
      ?>
      <header class="panel-heading">
        Lista Actividades y Gastos del Proyecto
      </header>
      <header class="panel-heading tab-bg-dark-navy-blue ">
        <ul class="nav nav-tabs">
          <li class="active">
            <a data-toggle="tab" href="#resumen" aria-expanded="false">Resumen</a>
          </li>
          <li class="">
            <a data-toggle="tab" href="#gastos" aria-expanded="false">Gastos</a>
          </li>
          <li class="">
            <a data-toggle="tab" href="#laboratorio" aria-expanded="false">Laboratorio</a>
          </li>
          <li class="">
            <a data-toggle="tab" href="#rates" aria-expanded="false">Rates</a>
          </li>
        </ul>

          








      </header>
      <div class="panel-body">
        <div class="tab-content">
          <div id="resumen" class="tab-pane active">
            <div class="panel-body">
              <?php
                $actividadpadre= new Admin_Model_DbTable_Actividad();
                $list=$actividadpadre->_getActividadesPadresxReplicon($this->proyecto['proyectoid'],$this->proyecto['codigo_prop_proy'],$this->proyecto['propuestaid'],$this->proyecto['revision']);
              ?>
              <table class="table table-hover p-table">
                <thead>
                  <tr>
                    <th style="width: 10%;">Id</th>
                    <th style="width: 70%;">Nombre Actividad</th>
                    <th style="width: 10;">Duracion</th>
                    <th style="width: 10%;">Acción</th>
                  </tr>
                </thead>
                <tbody>
                  <?php foreach ($list as $lista) { ?>
                  <tr>
                    <td><?php print_r($lista['actividadid']); ?></td>
                    <td><?php print_r($lista['nombre']); ?></td>
                    <td><?php print_r($lista['h_propuesta']);?></td>
                    <td></td>
                  </tr>
                  <?php }?>
                </tbody>
              </table>
            </div>
          </div>
          <div id="gastos" class="tab-pane">
            <div class="panel-body">
            </div>
          </div>
          <div id="laboratorio" class="tab-pane">
            <div class="panel-body">
              laboratorio
            </div>
          </div>
          <div id="rates" class="tab-pane">
            <!--llamar al modulo control de proyecto angular -->
    
             <!-- --> 
          </div>
        </div>
      </div>
    </section>
  </div>






  <div class="col-md-4">
    <section class="panel">
      <header class="panel-heading">
        Descripcion Proyecto
      </header>
      <div class="panel-body">
        <div class="panel-body">
          <?php
          $nombre_fichero = './img/cliente/'.$this->proyecto['clienteid'].'.jpg';
            if (file_exists($nombre_fichero))  { ?>
              <a href="" class="logo"><img width="150" src="/img/cliente/<?php print_r($this->proyecto['clienteid']);?>.jpg"></a>
          <?php }
            else
            {?>
              <a href="" class="logo"><img width="150" src="/img/logo.jpg"></a>
            <?php
          }?>
        </div>
        <div class="panel-body">
          <h4 ><?php print_r($this->proyecto['nombre_proyecto'])?></h4>
          <p style="font-size: 12px;"> <?php print_r($this->proyecto['descripcion']); ?></p>
        </div>
        <h5 class="bold">Lista de Disciplinas</h5>
                  <!-- este es el formulario -->
            <a id="anadirarea" href="##" class="btn btn-info btn-xs" >Anadir</a>
            <form action="">

              <select id="area_categoria" class="form-control input-sm m-bot15 col-lg-10">
                <option>Seleccione el Area</option>
                <?php
                  foreach ($this->area as $data_area) {?>
                    <option value="<?php echo $data_area['areaid'].";-;".$data_area['nombre']?>"><?php  echo $data_area['nombre']?></option>
                      <?php }?>
                    </select>
                    <select id="function" class="form-control input-sm m-bot15 col-lg-10">
                        <option value="SOPORTE">Soporte</option>
                        <option value="PROYECTO">Proyecto</option>
              </select>

                    <input value="Guardar" type="submit" />
            </form>
            <!-- fin de formulario-->

          <?php
          $bdequipoarea = new Admin_Model_DbTable_Equipoarea();
          $area=$bdequipoarea->_buscarAreasxProyecto($this->proyecto['codigo_prop_proy'],$this->proyecto['proyectoid']);
          $i=1;
          if ($area){
              //print_r(count($area));
              $countdatos=count($area);
              //print $countdatos;

          ?>
            <div  id="fech" >
              <input style="display:none" id="fechasemana" type="text" value="<?php echo $countdatos ?>">
            </div>


              <div class="panel-group m-bot20" id="accordion">
              <?php
              foreach ($area as $lista) { ?>
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a style="font-size: 12px;" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#<?php echo $i;?>">
                        <?php print_r($lista['areaid']);
                        echo "-"; print_r($lista['nombre']); ?>
                      </a>
                      <span class="pull-right">
                        <a class="btn btn-info btn-xs" id="anadir_<?php echo $i?>" href="#" proyectoid="<?php echo $this->proyecto['proyectoid']?>"  codigo-prop-proy="<?php echo $this->proyecto['codigo_prop_proy'] ?>" areaid="<?php print_r($lista['areaid'])?>">+ </a>
                        <a class="btn btn-danger btn-xs" id="asigna_<?php echo $i?>" href="#" proyectoid="<?php echo $this->proyecto['proyectoid']?>"  codigo-prop-proy="<?php echo $this->proyecto['codigo_prop_proy'] ?>" areaid="<?php print_r($lista['areaid'])?>" >H </a>
                      </span>
                    </h4>
                  </div>
                  <div id="<?php echo $i;?>" class="panel-collapse collapse">
                    <div class="panel-body">
                    <?php
                      $bdequipo = new Admin_Model_DbTable_Equipo();
                      $equipo=$bdequipo->_buscarEquipoxProyectoxArea($this->proyecto['codigo_prop_proy'],$this->proyecto['proyectoid'],$lista['areaid']);?>

                      <section class="posts">

                        <table style="font-size: 12px;" class="table table-hover p-table">
                          <thead>
                            <tr>
                              <th style="width: 50%;">Nombre</th>
                              <th style="width: 20%;">Categoria</th>
                              <th style="width: 10;">R.</th>
                              <th style="width: 10%;">R.Proy.</th>
                            </tr>
                          </thead>
                          <?php
                          $j=0;
                          foreach ($equipo as $lista) {
                          ?>
                            <tr>
                              <td class="p-name">
                                <a id="equipo_<?php echo $lista['dni']?>" href="#" proyectoid="<?php echo $this->proyecto['proyectoid']?>"  codigo-prop-proy="<?php echo $this->proyecto['codigo_prop_proy'] ?>" areaid="<?php print_r($lista['areaid'])?>" dni="<?php echo $lista['dni'];?>" uid="<?php echo $lista['uid'];?>"><?php $porciones = explode(".", $lista['uid']);
                                  echo (ucwords($porciones[0])); echo " ";echo (ucwords($porciones[1])); ?>
                                </a>
                              </td>
                              <td><?php
                                $dbcat= new Admin_Model_DbTable_Categoria();
                                $bucarcat=$dbcat->_getCategoriaxCategoriaid($lista['categoriaid']);
                                print_r($bucarcat[0]['categoriaid']);?>
                              </td>
                              <td>
                                <?php
                                $dbcat= new Admin_Model_DbTable_Categoria();
                                $bucarcat=$dbcat->_getCategoriaxCategoriaid($lista['categoriaid']);
                                print_r($bucarcat[0]['rate_externo']);
                                ?>
                              </td>
                              <td>
                                <?php echo $lista['rate_proyecto']; ?>
                                <!-- <span class="hty_<?php echo $i ?><?php echo $j ?>" onclick="trae(this)"  values="gg" >vvvv</span> -->
                              </td>
                              <td style="display:none">
                                 <?php echo $lista['dni'];?>
                              </td>
                              <td style="display:none">
                                 <?php echo $lista['uid'];?>
                              </td>
                              <td style="display:none" class="areaidcont_<?php echo $i?><?php echo $j?>">
                                 <?php echo $lista['areaid'];?>
                              </td>
                              <td>
                                <span class="editar" id="editar_<?php echo $i?><?php echo $j?>" onclick="transformarEnEditable(this)">Editar</span>
                              </td>
                            </tr>
                            <div id="contenedorForm_<?php echo $i?><?php echo $j?>"></div>

                            <script type="text/javascript">
                              $(document).ready(function(){
                                $("#equipo_<?php echo  $lista['dni']?>").click(function(){
                                  var proyectoid = $(this).attr('proyectoid');
                                  var codigo_prop_proy = $(this).attr('codigo-prop-proy');
                                  var areaid = $(this).attr('areaid');
                                  var dni = $(this).attr('dni');
                                  var uid = $(this).attr('uid');
                                  $("#myModalequipo").modal('show')
                                  var url = "/proyecto/index/modificarequipo/proyectoid/"+ proyectoid+"/codigo_prop_proy/"+codigo_prop_proy+"/areaid/"+areaid+"/dni/"+dni+"/uid/"+uid;
                                  $("#modaltimes_equipo").load(url);
                                });
                              });
                            </script>

                            <script>
                              var editando=false;
                              function transformarEnEditable(nodo){
                              //El nodo recibido es SPAN

                              var x=nodo.value;
                              var i=parseInt(nodo.id.charAt(7));
                              var j=parseInt(nodo.id.charAt(8));
                              /*
                              alert(i);
                              alert(j);
                              */
                              if (editando == false) {


                              var nodoTd = nodo.parentNode; //Nodo TD
                              var nodoTr = nodoTd.parentNode; //Nodo TR
                              var nodoContenedorForm = document.getElementById('contenedorForm_'+i+j); //Nodo DIV
                              console.log('contenedorForm_'+i+j);
                              console.log('editar_'+i+j);
                              var nodosEnTr = nodoTr.getElementsByTagName('td');
                              var nombre = nodosEnTr[0].textContent;
                              var categoria = nodosEnTr[1].textContent;
                              var rate = nodosEnTr[2].textContent;
                              var rate_proyecto = nodosEnTr[3].textContent;
                              var dni = nodosEnTr[4].textContent;
                              var uid = nodosEnTr[5].textContent;
                              var areaid = nodosEnTr[6].textContent;
                              /*
                              alert(nombre);
                              alert(dni);
                              alert(uid);
                              alert(areaid);*/

                              var nuevoCodigoHtml =
                              '<td><input disabled type="text" name="nombre" id="nombre" value="'+nombre.trim()+'" size="15"></td>'+
                              '<td><input disabled type="text" name="categoria" id="categoria" value="'+categoria.trim()+'" size="8"</td>'+
                              '<td><input disabled type="text" name="rate" id="rate" value="'+rate.trim()+'" size="5"</td>'+
                              '<td><input type="text" name="rate_proyecto" id="rate_proyecto" value="'+rate_proyecto.trim()+'" size="5"</td>'+'<td>En ediciónss</td>'+
                              '<td><input style="display:none" type="text" name="dnix" id="dnix" value="'+dni+'" size="5"</td>'+
                              '<td><input style="display:none" type="text" name="uidx" id="uidx" value="'+uid+'" size="5"</td>'+
                              '<td><input style="display:none" type="text" name="areaidx" id="areaidx" value="'+areaid+'" size="5"</td>'
                              ;

                              nodoTr.innerHTML = nuevoCodigoHtml;

                              nodoContenedorForm.innerHTML = 'Pulse Aceptar para guardar los cambios o cancelar para anularlos'+
                                   '<input class="boton" id="aceptar_<?php echo $i?><?php echo $j?>" type = "submit" value="Aceptar" onclick="capturarEnvio()"> <input class="boton" id="i" type="reset" value="Cancelar"  onclick="anular(this)" >';
                                 // editando = "true";

                              var nombrevar = $("#nombre").val();
                              var categoriavar = $("#categoria").val();
                              var ratevar = $("#rate").val();
                              var rateproyectovar = $("#rate_proyecto").val();

                              $("#rate_proyecto").keypress(function(e){
                                  //alert('entro');
                                  if(e.keyCode == 13){

                                  e.preventDefault();
                                  var nombrexy = $("#nombre").val();
                                  var categoriaxy = $("#categoria").val();
                                  var ratexy = $("#rate").val();
                                  var rateproyectoxy = $("#rate_proyecto").val();
                                 // alert(rateproyectoxy);

                                  var nuevoCodigoHtml =
                                  '<td><input disabled type="text" name="nombre" id="nombre" value="'+nombrexy.trim()+'" size="15"></td>'+
                                  '<td><input disabled type="text" name="categoria" id="categoria" value="'+categoriaxy.trim()+'" size="8"</td>'+
                                  '<td><input disabled type="text" name="rate" id="rate" value="'+ratexy.trim()+'" size="5"</td>'+
                                  '<td><input disabled type="text" name="rate_proyecto" id="rate_proyecto" value="'+rateproyectoxy.trim()+'" size="5"</td>'+
                                  '<td><span class="editar"  onclick="whilex(this)" >Editar</span></td>'
                                  +'<td><input style="display:none" type="text" name="dnix" id="dnix" value="'+dni+'" size="5"</td>'+
                                  '<td><input style="display:none" type="text" name="uidx" id="uidx" value="'+uid+'" size="5"</td>'+
                                  '<td><input style="display:none" type="text" name="areaidx" id="areaidx" value="'+areaid+'" size="5"</td>';

                                  nodoTr.innerHTML = nuevoCodigoHtml;

                                  nodoContenedorForm.innerHTML = 'Pulse Aceptar para guardar los cambios o cancelar para anularlos'+
                                   '<input class="boton" type = "submit" value="Aceptar" onclick="capturarEnvio()"> <input class="boton" type="reset" value="Cancelar"  onclick="anular(this)" >';
                                  editando = "true";

                                  }
                                });

                              }
                              else
                                {
                                  alert ('Solo se puede editar una línea. Recargue la página para poder editar otra');
                                }

                              }

                              function enter(nodo)
                              {
                                $("#rate_proyecto").keyup(function(e){
                                  //alert('estoy en enter');
                                  var nodoTd = nodo.parentNode; //Nodo TD
                                  var nodoTr = nodoTd.parentNode; //Nodo TR
                                  var nodoContenedorForm = document.getElementById('contenedorForm'); //Nodo DIV

                                  if(e.keyCode == 13){
                                  e.preventDefault();
                                  var nombrexy = $("#nombre").val();
                                  var categoriaxy = $("#categoria").val();
                                  var ratexy = $("#rate").val();
                                  var rateproyectoxy = $("#rate_proyecto").val();
                                  var uid = $("#uidx").val();
                                  var dni = $("#dnix").val();
                                  var areaid = $("#areaidx").val();

                                  //alert(rateproyectoxy);

                                  var nuevoCodigoHtml =
                                  '<td><input disabled type="text" name="nombre" id="nombre" value="'+nombrexy.trim()+'" size="15"></td>'+
                                  '<td><input disabled type="text" name="categoria" id="categoria" value="'+categoriaxy.trim()+'" size="8"</td>'+
                                  '<td><input disabled type="text" name="rate" id="rate" value="'+ratexy.trim()+'" size="5"</td>'+
                                  '<td><input disabled type="text" name="rate_proyecto" id="rate_proyecto" value="'+rateproyectoxy.trim()+'" size="5"</td>'+
                                  '<td><span class="editar" onclick="whilex(this)" >enter</span></td>'
                                  +'<td><input style="display:none" type="text" name="dnix" id="dnix" value="'+dni+'" size="5"</td>'+
                                  '<td><input style="display:none" type="text" name="uidx" id="uidx" value="'+uid+'" size="5"</td>'+
                                  '<td><input style="display:none" type="text" name="areaidx" id="areaidx" value="'+areaid+'" size="5"</td>'
                                  ;
                                  nodoTr.innerHTML = nuevoCodigoHtml;

                                nodoContenedorForm.innerHTML = 'Pulse Aceptar para guardar los cambios o cancelar para anularlos'+
                                 '<input class="boton" type = "submit" value="Aceptar" onclick="capturarEnvio()"> <input class="boton" type="reset" value="Cancelar"  onclick="anular()" >';
                                  editando = "true";
                                }
                                });
                              }

                              function whilex(nodo){
                                     //alert('whilex');
                                      var nodoTd = nodo.parentNode; //Nodo TD
                                      var nodoTr = nodoTd.parentNode; //Nodo TR
                                      var nodoContenedorForm = document.getElementById('contenedorForm'); //Nodo DIV
                                      var nombremod = $("#nombre").val();
                                      var categoriamod = $("#categoria").val();
                                      var ratemod = $("#rate").val();
                                      var rateproyectomod = $("#rate_proyecto").val();
                                      var uid = $("#uidx").val();
                                      var dni = $("#dnix").val();
                                      var areaid = $("#areaidx").val();

                                      var nuevoCodigoHtml =
                                      '<td><input type="text" name="nombre" id="nombre" value="'+nombremod+'" size="15"></td>'+
                                      '<td><input type="text" name="categoria" id="categoria" value="'+categoriamod+'" size="8"</td>'+
                                      '<td><input type="text" name="rate" id="rate" value="'+ratemod+'" size="5"</td>'+
                                      '<td><input type="text" name="rate_proyecto" onkeyup="enter(this)" id="rate_proyecto" value="'+rateproyectomod+'" size="5"</td>'+'<td>en edicion while</td>'+
                                      '<td><input style="display:none" type="text" name="dnix" id="dnix" value="'+dni+'" size="5"</td>'+
                                      '<td><input style="display:none" type="text" name="uidx" id="uidx" value="'+uid+'" size="5"</td>'+
                                      '<td><input style="display:none" type="text" name="areaidx" id="areaidx" value="'+areaid+'" size="5"</td>'
                                      ;
                                      nodoTr.innerHTML = nuevoCodigoHtml;
                              }

                              function capturarEnvio(nodo){
                                //console.log("ffffffaaa");
                                var nombremod = $("#nombre").val();
                                var categoriamod = $("#categoria").val();
                                var ratemod = $("#rate").val();
                                var rateproyectomod = $("#rate_proyecto").val();
                                var uid = $("#uidx").val();
                                var dni = $("#dnix").val();
                                var areaid = $("#areaidx").val();

                                var proyecto="<?php echo $this->proyecto['proyectoid']?>";
                                var codigo="<?php echo $this->proyecto['codigo_prop_proy'] ?>";
                                // alert(nombremod);
                                // alert(categoriamod);
                                // alert(ratemod);
                                // alert(rateproyectomod);
                                // alert(proyecto);
                                // alert(codigo);
                                // alert(uid);
                                // alert(dni);
                                // alert(areaid);

                                $("#destinos").load("/proyecto/index/updateequipo/", {proyectoid: proyecto,codigo:codigo,dni:dni,uid:uid,areaid:areaid,rate:rateproyectomod},
                                  function(){
                                  //alert("Campo actualizado");
                                  window.location.reload();

                                  //var editando=false;
                                  //$(nodoContenedorForm).hide();
                                  //$("#contenedorForm").html('');
                                  // document.getElementById("nombre").reset();
                                  // document.getElementById("categoria").reset();
                                  // document.getElementById("rate").reset();
                                  // document.getElementById("rate_proyecto").reset();
                                  // document.getElementById("uidx").reset();
                                  });
                                }

                                function anular(nodo){
                                  //window.location.reload();
                                  //var x=parseInt(i.value);
                                  //alert(x);
                                  //var i=parseInt(nodo.id.charAt(0));
                                  //var j=parseInt(nodo.id.charAt(7));

                                  //alert(i);
                                  //alert(j);

                                  //var i=4;
                                  //var j=1;

                                  //$("#contenedorForm_"+i).html('');
                                  window.location.reload();
                                }


                              </script>
                             <?php
                            $j++;
                            }?>
                        </table>
                      </section>
                      </div>
                    </div>
                </div>


                <script type="text/javascript">
                  $(document).ready(function(){
                    $("#anadir_<?php echo $i?>").click(function(){
                      //alert("ffff");
                      var proyectoid = $(this).attr('proyectoid');
                      var codigo_prop_proy = $(this).attr('codigo-prop-proy');
                      var areaid = $(this).attr('areaid');
                      $("#myModal9").modal('show')
                      var url = "/proyecto/index/buscarpersonasxcategoria/proyectoid/"+ proyectoid+"/codigo_prop_proy/"+codigo_prop_proy+"/areaid/"+areaid;
                      $("#modaltimes_rate").load(url);
                    });
                  });
                </script>

                <script type="text/javascript">
                  $(document).ready(function(){
                    $("#asigna_<?php echo $i?>").click(function(){
                      var proyectoid = $(this).attr('proyectoid');
                      var codigo_prop_proy = $(this).attr('codigo-prop-proy');
                      var areaid = $(this).attr('areaid');

                      $("#modalperson").modal('show')

                    var url = "/proyecto/index/asignaractividad/proyectoid/"+ proyectoid+"/codigo_prop_proy/"+codigo_prop_proy+"/areaid/"+areaid;
                    //alert(url);
                    $("#modaltimes").load(url);

                    });
                  });
                </script>



              <?php $i++;
                }
              }
              $countdatos=0;
              ?>
              <div  id="fech" >
                <input style="display:none" id="fechasemana" type="text" value="<?php echo $countdatos ?>">
              </div>


            </div>
          </div>
        </section>
      </div>
    </div>

    <script type="text/javascript">
      function anadir(ev)
        {

          var x=ev.value;
          var i=ev.id.charAt(7);
          var j=ev.id.charAt(8);
          var z=ev.id.charAt(9);
          var areax=i+j+z;
          //alert(i);
          //alert(j);
          //var areax = $("#areasx").val();
          var codigo="<?php echo $this->codigoproyecto ?>";
          var proyecto="<?php echo $this->proyectoid ?>";
          //var x=ev.value;
          //alert(areax);
          $("#myModal9").modal('show')
          var url = "/proyecto/index/buscarpersonasxcategoria/proyectoid/"+ proyecto+"/codigo_prop_proy/"+codigo+"/areaid/"+areax;
          //alert(url);
          $("#modaltimes_rate").load(url);
          //alert(x);
        }

      function asigna(ev)
        {
          var x=ev.value;
          var i=ev.id.charAt(7);
          var j=ev.id.charAt(8);
          var z=ev.id.charAt(9);
          var areax=i+j+z;
          //alert(i);
          //alert(j);
          //var areax = $("#areasx").val();
          var codigo="<?php echo $this->codigoproyecto ?>";
          var proyecto="<?php echo $this->proyectoid ?>";
          //var x=ev.value;
          //alert(areax);
          $("#modalperson").modal('show')
          var url = "/proyecto/index/asignaractividad/proyectoid/"+ proyecto+"/codigo_prop_proy/"+codigo+"/areaid/"+areax;
          //alert(url);
          $("#modaltimes").load(url);
        }



        function ver()
        {
          var nuevoCodigoHtml =
            '<td><input disabled type="text" name="nombre" id="nombre" value="areacat.trim()" size="15"></td>'+
            '<td><input disabled type="text" name="categoria" id="categoria" value="areacat.trim()" size="8"</td>'+
            '<td><input disabled type="text" name="rate" id="rate" value="areacat.trim()" size="5"</td>'+
            '<td><input type="text" name="rate_proyecto" id="rate_proyecto" value="areacat.trim()" size="5"</td>'+'<td>En ediciónss</td>'+
            '<td><input style="display:none" type="text" name="dnix" id="dnix" value="areacat.trim()" size="5"</td>'+
            '<td><input style="display:none" type="text" name="uidx" id="uidx" value="areacat.trim()" size="5"</td>'+
            '<td><input style="display:none" type="text" name="areaidx" id="areaidx" value="areacat.trim()" size="5"</td>';

                              //nodoTr.innerHTML = nuevoCodigoHtml;
            $('#accordion').prepend($(nuevoCodigoHtml).fadeIn());
        }

    </script>

    <script>
      $(function(){
      //$('form').hide();
      $('form').slideUp();
      //$(this).parent().children('#anadirarea').remove();

      $('#anadirarea').on('click', mostrarFormulario);

      function mostrarFormulario() {
        $('form').slideToggle();
      }

      $('form').on('submit', procesarFormulario);

      function procesarFormulario(ev)
      {
        //ev.preventDefault();
        var areacatx= $("#area_categoria").val();
        tmp=areacatx.split(";-;");
        areacat=tmp[0];
        nom=tmp[1];

        var funcion= $("#function").val();
        var codigo="<?php echo $this->codigoproyecto ?>";
        var proyecto="<?php echo $this->proyectoid ?>";

        var fechasemana= $("#fechasemana").val();
        //alert(fechasemana);

        campo = parseInt(fechasemana)+1;
        //alert(campo);
        document.getElementById('fechasemana').defaultValue=campo;
        //alert('Dominio solicitado: '+campo);

        var url="/proyecto/index/guardarareaequipo/codigo_prop_proy/"+codigo+"/proyectoid/"+proyecto+"/funcion/"+funcion+"/area/"+areacat;


        $.ajax({
             type: "POST",
             url: url,
              data: $(this).serialize(),
              dataType: "html",
              error: function()
              {
                alert("error petición ajax load");
              },
              success: function(data)
              {
                //e.preventDefault();
                $("#anadirareaproyecto").empty();
                $("#anadirareaproyecto").html(data);
                //$("#accordion").append("<li>"+"person.name"+"("+")"+"</li");
              }
        });
        //alert(url);
        //$(this).parent().children('#area_categoria').remove();
        //var i=100;
        var template=
                     '<div class="panel panel-default">'+'<div class="panel-heading">'+'<h4 class="panel-title" >'+
                     '<tr>'+'<a style="font-size: 12px;" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#'+campo+'">'+  '<td style="font-size: 12px;">' +areacat+ '-</td>'+'<td>'+nom+'</td>' +'<a>'+
                     '<td><input style="display:none" disabled type="text" name="areasx" id="areasx" value="'+areacat+'" size="5"></td>'+
                     '<span class="pull-right">'+
                     '<td><span  btn btn-danger btn-xs" onclick="ver()">.</span></td>'+
                     '<td><span  id="anadir_'+areacat+'" class="editar btn btn-info btn-xs" onclick="anadir(this)">+</span></td>'+
                     '<td><span  id="anadir_'+areacat+'" class="editar btn btn-danger btn-xs" onclick="asigna(this)">H</span></td>'
                     +'</span>'+'<tr>'+'</h4>'+'</div>'+'</div>';


        //$(this).parent().innerHTML = template;
        //nube = '<a disabled="disabled"> <i style="color: #D6D6D8" class="fa fa-comment"></i></a>';
        $(this).parent().append(template);


        $('form').slideUp();

      }
    });
</script>

    <div id="destinos"></div>
    <!-- sirve para editar-->
<!--


<!-- page end-->
<div class="modal fade modal-dialog-center top-modal-with-space" id="myModalequipo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Cambiar Rate del Proyecto</h4>
        </div>
        <div class="modal-body">
          <div id="modaltimes_equipo"></div>
        </div>
        <div class="modal-footer">
          <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>

        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalperson" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
  <div class="">
    <div class="modal-content" style="width: 100%; top: 100%;  ">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" scrollbars=1>&times;</button>
          <h4 class="modal-title">Asignar Personas a una Actividad</h4>
      </div>
      <div class="modal-body" >
        <div id="modaltimes"></div>
      </div>
      <div class="modal-footer">
        <button  data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>

      </div>
    </div>
    </div>
  </div>
</div>


<script type="text/javascript">

    $(document).ready(function(){
    $("#asigna").click(function(){
      var proyectoid = $(this).attr('proyectoid');
      var codigo_prop_proy = $(this).attr('codigo-prop-proy');

      $("#modalperson").modal('show')

    var url = "/proyecto/index/asignaractividad/proyectoid/"+ proyectoid+"/codigo_prop_proy/"+codigo_prop_proy;
    $("#modaltimes").load(url);

     });
    });
</script>


<div class="modal fade modal-dialog-center top-modal-with-space" id="myModal9" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Añadir Personas x Rate al Proyecto</h4>
        </div>
        <div class="modal-body">

          <div id="modaltimes_rate" >
          </div>


        </div>
        <div class="modal-footer">
          <button data-dismiss="modal" id="cerrar_anadir" class="btn btn-default" type="button">Cerrar</button>

        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
   // $("#cerrar_anadir").click(function(){
   //    window.location.reload();
   // });
</script>


<div id="anadirareaproyecto"></div>

<script>

 $("#equipo_areaid").change(function(){
    var areaid = $(this).val();
    //alert(areaid);
    url="/proyecto/index/buscarcategoria/areaid/"+areaid;
    //alert(url);
    $("#categoriaid").load(url);
    });

  $("#categoriaid").change(function(){
    var categoriaid = $(this).val();
    var areaid = $("#equipo_areaid").val();
    var proyectoid='<?php echo $this->proyecto['proyectoid']; ?>';
    var codigo='<?php echo $this->proyecto['codigo_prop_proy']; ?>';



    url="/proyecto/index/buscarpersonasxcategoria/categoria/"+categoriaid+"/areaid/"+areaid+"/proyectoid/"+proyectoid+"/codigo/"+codigo;

   $("#nombre_colaborador").load(url);
    });


$(document).ready(function(){

$("#guardar_contacto").click(function(){
var clienteid = $("#clienteid").val();
var areaid = $("#areaid").val();
var numero = $("#numero").val();
var relacion = $("#relacion").val();
var correo = $("#correo").val();
var telefono = $("#telefono").val();
var anexo = $("#anexo").val();

var captura_direccion = $("#direccion").val();
var direccion= captura_direccion.replace(/\s/g,"_");
var captura_nombre_contacto = $("#nombre_contacto").val();
var nombre_contacto= captura_nombre_contacto.replace(/\s/g,"_");
if (clienteid=='')
{ alert("cargue nuevamente la pagina");        }
else
{ url="/comercial/index/guardarcontacto/clienteid/"+clienteid+"/areaid/"+areaid+"/numero/"+numero+"/relacion/"+relacion+"/nombre_contacto/"+nombre_contacto+"/correo/"+correo+"/direccion/"+direccion+"telefono/"+telefono+"/anexo/"+anexo;

$("#cargar").load(url);
}
});

$("#clienteid").click(function(){
var clienteid = $("#clienteid").val();
url="/comercial/index/direccion/clienteid/"+clienteid;

$("#direccion_valida").load(url);


});

$("#btn_buscar_propuesta").click(function(){
var buscar_propuesta = $("#buscar_propuesta").val();

$("#propuesta_enelaboracion").hide();
$("#propuesta_enelaboracion").hide();
$("#propuesta_ganada").hide();
$("#propuesta_perdida").hide();
$("#propuesta_enviada").hide();
$("#propuesta_declinada").hide();
$("#propuesta_anulada").hide();
$("#resultado_busqueda").show();
if (buscar_propuesta=='')
{
alert("ingrese propuesta a buscar");
}
else
{
var url="/propuesta/index/buscar/propuesta/"+buscar_propuesta;
}
$("#resultado_busqueda").load(url);
});



});

$(document).on("click", ".open-Modal", function () {
var myDNI = $(this).data('id');
$(".modal-body #DNI").val( myDNI );
});

</script>
